<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kết quả Bài toán Quy hoạch Tuyến tính</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f4f8; /* bg-slate-100 */
            color: #334155; /* text-slate-700 */
            line-height: 1.6;
        }
        .container-wrapper {
            max-width: 1000px;
            margin: 3rem auto;
            background-color: white;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.06), 0 20px 40px -15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        .back-button {
            display: inline-flex;
            align-items: center;
            background-color: #6366f1; /* bg-indigo-500 */
            color: white;
            font-weight: 500; /* font-medium */
            padding: 0.625rem 1.25rem; /* py-2.5 px-5 */
            border-radius: 0.5rem;  /* rounded-lg */
            transition: all 0.2s ease-in-out;
            margin-bottom: 2.5rem;
            text-decoration: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05), 0 1px 2px rgba(99,102,241,0.15);
        }
        .back-button:hover {
            background-color: #4f46e5; /* hover:bg-indigo-600 */
            transform: translateY(-1px);
            box-shadow: 0 6px 12px -3px rgba(99,102,241,0.2), 0 3px 7px -3px rgba(0,0,0,0.08);
        }
        .back-button svg { margin-right: 0.5rem; } /* mr-2 */
        .results-header {
            padding: 2.5rem 2rem; /* px-8 py-10 */
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 60%, #818cf8 100%);
            color: white;
            margin-bottom: 0;
        }
        h1.main-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            margin-bottom: 0.5rem; /* mb-2 */
            text-align: center;
            color: white;
            letter-spacing: -0.01em;
        }
        p.subtitle {
            text-align: center;
            color: #e0e7ff; /* text-indigo-100 */
            margin-top: 0;
            font-size: 1.05rem; /* text-lg-ish */
            font-weight: 300; /* font-light */
        }
        .content-wrapper {
            padding: 2.5rem; /* p-10 */
        }
        h2.section-title {
            font-size: 1.75rem; /* text-2xl or text-3xl */
            font-weight: 600; /* font-semibold */
            color: #4338ca; /* text-indigo-700 */
            margin-top: 0;
            margin-bottom: 1.5rem; /* mb-6 */
            padding-bottom: 0.75rem; /* pb-3 */
            border-bottom: 2px solid #e0e7ff; /* border-indigo-200 */
            display: flex;
            align-items: center;
        }
        h2.section-title svg, h2.section-title .icon {
            margin-right: 0.75rem; /* mr-3 */
            color: #6366f1; /* text-indigo-500 */
            width: 26px;
            height: 26px;
        }
        .step-details {
            background-color: #ffffff;
            border: 1px solid #eef2ff; /* border-indigo-100 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 0.75rem 1.75rem 1.5rem 1.75rem; /* px-7 py-3 pb-6 */
            margin-bottom: 2rem; /* mb-8 */
            box-shadow: 0 2px 5px 0 rgba(0,0,0,0.04);
        }
        h3.step-title {
            font-size: 1.375rem; /* text-xl or text-2xl */
            font-weight: 600; /* font-semibold */
            color: #4f46e5; /* text-indigo-600 */
            margin-top: 0;
            margin-bottom: 0.5rem; /* mb-2 */
        }
        .result-section {
            padding: 1.75rem; /* p-7 */
            background-color: #f9fafb; /* bg-slate-50 */
            border: 1px solid #eef2ff; /* border-indigo-100 */
            border-radius: 0.625rem; /* rounded-lg-ish */
            margin-bottom: 2.5rem; /* mb-10 */
            box-shadow: 0 4px 8px rgba(0,0,0,0.02), 0 6px 12px rgba(0,0,0,0.03);
        }
        .result-section:last-child {
            margin-bottom: 0;
        }
        .label {
            font-weight: 500; /* font-medium */
            color: #64748b; /* text-slate-500 */
            margin-bottom: 0.375rem; /* mb-1.5 */
            font-size: 0.875rem; /* text-sm */
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .value {
            font-weight: 600; /* font-semibold */
            color: #4f46e5; /* text-indigo-600 */
            font-size: 1.3rem; /* text-xl-ish */
        }
        .status-optimal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 1.5rem; /* gap-6 */
        }
        .optimal-solution-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600; /* font-semibold */
            color: #4f46e5; /* text-indigo-600 */
            margin-bottom: 0.75rem; /* mb-3 */
            display: flex;
            align-items: center;
        }
        .optimal-solution-title svg {
            margin-right: 0.625rem; /* mr-2.5 */
            width: 24px;
            height: 24px;
            color: #4f46e5; /* text-indigo-600 */
        }
        .optimal-solution-hr {
            border: 0;
            height: 1px;
            background-color: #cbd5e1; /* bg-slate-300 */
            margin-bottom: 1.25rem; /* mb-5 */
        }
        .solution-item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.625rem 0; /* py-2.5 */
            border-bottom: 1px solid #f3f4f6; /* border-slate-100 */
        }
        .solution-item-row:last-child { border-bottom: none; }
        .solution-item-var {
            font-size: 0.95rem;
            color: #374151; /* text-slate-700 */
            font-weight: 500; /* font-medium */
        }
        .solution-item-val {
            font-size: 0.95rem;
            color: #4338ca; /* text-indigo-700 */
            font-weight: 600; /* font-semibold */
            background-color: #eef2ff; /* bg-indigo-100 */
            padding: 0.25rem 0.5rem; /* py-1 px-2 */
            border-radius: 0.25rem; /* rounded-sm */
        }
        pre {
            background-color: #ffffff; 
            padding: 1.75rem;          
            border-radius: 0.5rem;     
            overflow-x: auto;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap; 
            word-wrap: break-word; 
            border: 1px solid #eef2ff; 
            color: #1e293b;            
            line-height: 1.6;          
            margin-top: 0.75rem;
            box-shadow: none;          
        }
        .tableau-objective-line {
            display: block;
            padding-bottom: 0.2em; /* Giảm padding để đường kẻ gần chữ hơn */
            margin-bottom: 0;     /* Đảm bảo không có margin sau đường kẻ */
            border-bottom: 1px solid #cbd5e1; 
        }
        img.plot-image {
            max-width: 100%;
            height: auto;
            border-radius: 0.625rem; /* rounded-lg-ish */
            margin: 1rem auto 0;
            display: block;
            border: 1px solid #e5e7eb; /* border-slate-200 */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.07);
        }
        .footer {
            text-align: center;
            padding: 2.5rem 1rem; /* py-10 px-4 */
            font-size: 0.875rem; /* text-sm */
            color: #64748b; /* text-slate-500 */
            background-color: #f8fafc; /* bg-slate-50 */
            border-top: 1px solid #e2e8f0; /* border-t border-slate-200 */
            margin-top: 3rem; /* mt-12 */
        }
        .error-message {
            color: #dc2626; /* text-red-600 */
            background-color: #fee2e2; /* bg-red-100 */
            border: 1px solid #fecaca; /* border-red-200 */
            padding: 1rem; /* p-4 */
            border-radius: 0.5rem; /* rounded-lg */
            margin-top: 1rem; /* mt-4 */
            font-weight: 500; /* font-medium */
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container-wrapper { margin: 2rem 1.5rem; }
            .results-header { padding: 2rem 1.5rem; }
            .content-wrapper { padding: 2rem 1.75rem; }
            h1.main-title { font-size: 2rem; }
            p.subtitle { font-size: 1rem; }
            h2.section-title { font-size: 1.625rem; }
            h3.step-title { font-size: 1.25rem; }
            .back-button { width: 100%; justify-content: center; padding: 0.875rem; margin-bottom: 2rem;}
            .result-section { padding: 1.5rem; }
            .step-details { padding: 0.75rem 1.5rem 1.25rem 1.5rem; }
            pre { font-size: 0.875rem; padding: 1.5rem; line-height: 1.6; }
            .value { font-size: 1.2rem; }
            .optimal-solution-title { font-size: 1.375rem; }
            .solution-item-var, .solution-item-val { font-size: 0.9rem; }
        }
        @media (max-width: 480px) {
            .container-wrapper { margin: 1.5rem 1rem; border-radius: 0.5rem; }
            .results-header { padding: 1.5rem 1rem; }
            .content-wrapper { padding: 1.5rem 1rem; }
            h1.main-title { font-size: 1.75rem; }
            p.subtitle { font-size: 0.9rem; }
            h2.section-title { font-size: 1.375rem;}
            h3.step-title { font-size: 1.15rem; }
            .result-section { padding: 1.25rem; border-radius: 0.5rem; }
            .step-details { padding: 0.5rem 1rem 1rem 1rem; }
            pre { font-size: 0.825rem; padding: 1.25rem; line-height: 1.6;}
            .value { font-size: 1.1rem; }
            .back-button { font-size: 0.9rem; padding: 0.75rem; }
            .back-button svg { margin-right: 0.4rem; }
            .optimal-solution-title { font-size: 1.25rem; }
            .solution-item-var, .solution-item-val { font-size: 0.875rem; }
            .solution-item-row { padding: 0.5rem 0; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <div class="container-wrapper">
        <header class="results-header">
            <h1 class="main-title">Kết quả Giải Bài Toán</h1>
            <p class="subtitle">Quy hoạch Tuyến tính</p>
        </header>

        <div class="content-wrapper">
            <a href="javascript:history.back()" class="back-button">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
                Quay lại trang trước
            </a>

            {% if num_vars == 2 %}
            <div class="result-section" id="plot-section">
                 <h2 class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" />
                    </svg>
                    Phương pháp Hình học (Đồ thị)
                </h2>
                {% if plot_data %}
                    <img src="data:image/png;base64,{{ plot_data }}" alt="Biểu đồ miền khả thi và nghiệm tối ưu" class="plot-image" id="plot-image-src">
                {% elif plot_error_message %}
                    <p class="error-message">{{ plot_error_message }}</p>
                {% else %}
                    <p class="text-slate-500">Không có dữ liệu đồ thị để hiển thị (có thể do lỗi hoặc bài toán không phải 2 biến).</p>
                {% endif %}
            </div>
            {% endif %}

            {% if result_bland and result_bland.status != 'Không áp dụng (Not Applicable)' %}
            <div class="result-section" id="bland-results">
                <h2 class="section-title">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25A2.25 2.25 0 0113.5 8.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
                    </svg>
                    Phương pháp Đơn hình (Quy tắc Bland)
                </h2>
                <div class="status-optimal-grid">
                    <div> <p class="label">Trạng thái:</p> <p class="value">{{ result_bland.status }}</p> </div>
                    {% if result_bland.z is not none %}
                        <div> <p class="label">Giá trị tối ưu z*:</p> <p class="value">{{ result_bland.z }}</p> </div>
                    {% endif %}
                </div>

                {% if result_bland.solution and result_bland.solution.items()|length > 0 %}
                <div class="mt-6"> <h3 class="optimal-solution-title">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg> Nghiệm </h3>
                    <hr class="optimal-solution-hr">
                    <div>
                        {% for var, val in result_bland.solution.items() %}
                            <div class="solution-item-row"> <span class="solution-item-var">{{ var }}</span> <span class="solution-item-val">{{ val }}</span> </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if result_bland.error_message %} <p class="error-message">{{ result_bland.error_message }}</p> {% endif %}

                {% if result_bland.steps and not result_bland.status.lower().startswith('vô nghiệm') and not result_bland.status.lower().startswith('lỗi') and result_bland.status != 'Không áp dụng (Not Applicable)' %}
                <div class="mt-8"> <h3 class="optimal-solution-title" style="font-size: 1.3rem; margin-bottom: 0.5rem;">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width:22px; height:22px;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                        </svg> Chi tiết các bước (Đơn hình Bland) </h3>
                    <div class="space-y-6">
                        {% for title, tableau_list in result_bland.steps.items() %}
                        <div class="step-details">
                            <h3 class="step-title" style="font-size: 1.15rem;">{{ title }}</h3>
                            <pre>
{%- if tableau_list and tableau_list|length > 0 -%}
    {%- set first_var, first_expr = tableau_list[0] -%}
<span class="tableau-objective-line">{{ "%-4s = %s"|format(first_var, first_expr) }}</span>{%- for i in range(1, tableau_list|length) -%}{%- set var, expr = tableau_list[i] -%}{{- "%-4s = %s"|format(var, expr) -}}{%- if not loop.last %}{{ "\n" }}{% endif -%}{%- endfor -%}
{%- else -%}
(Bảng trống hoặc không có dữ liệu)
{%- endif -%}
                            </pre>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            {% elif result_bland and result_bland.status == 'Không áp dụng (Not Applicable)' %}
             <div class="result-section" id="bland-results-not-applicable">
                <h2 class="section-title">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25A2.25 2.25 0 0113.5 8.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
                    </svg> Phương pháp Đơn hình (Quy tắc Bland) </h2>
                <p class="label">Trạng thái:</p> <p class="value">{{ result_bland.status }}</p>
                {% if result_bland.error_message %} <p class="error-message mt-4">{{ result_bland.error_message }}</p> {% endif %}
            </div>
            {% endif %}

            {% if result_two_phase %}
            <div class="result-section" id="two-phase-results">
                <h2 class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 00-3.7-3.7 48.678 48.678 0 00-7.324 0 4.006 4.006 0 00-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3l-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 003.7 3.7 48.656 48.656 0 007.324 0 4.006 4.006 0 003.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3l-3 3" />
                    </svg> Phương pháp Đơn hình 2 Pha </h2>
                 <div class="status-optimal-grid">
                    <div> <p class="label">Trạng thái:</p> <p class="value">{{ result_two_phase.status }}</p> </div>
                    {% if result_two_phase.z is not none %}
                        <div> <p class="label">Giá trị tối ưu z*:</p> <p class="value">{{ result_two_phase.z }}</p> </div>
                    {% endif %}
                </div>

                {% if result_two_phase.solution and result_two_phase.solution.items()|length > 0 %}
                <div class="mt-6"> <h3 class="optimal-solution-title">
                         <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg> Nghiệm </h3>
                    <hr class="optimal-solution-hr">
                    <div>
                        {% for var, val in result_two_phase.solution.items() %}
                            <div class="solution-item-row"> <span class="solution-item-var">{{ var }}</span> <span class="solution-item-val">{{ val }}</span> </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if result_two_phase.error_message %} <p class="error-message">{{ result_two_phase.error_message }}</p> {% endif %}

                {% if result_two_phase.steps and not result_two_phase.status.lower().startswith('vô nghiệm') and not result_two_phase.status.lower().startswith('lỗi') %}
                <div class="mt-8">
                     <h3 class="optimal-solution-title" style="font-size: 1.3rem; margin-bottom: 0.5rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width:22px; height:22px;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                        </svg> Chi tiết các bước (Đơn hình 2 Pha) </h3>
                    <div class="space-y-6">
                        {% for title, tableau_list in result_two_phase.steps.items() -%}
                        <div class="step-details">
                            <h3 class="step-title" style="font-size: 1.15rem;">{{ title }}</h3>
                            <pre>
{%- if tableau_list and tableau_list|length > 0 -%}
    {%- set first_var, first_expr = tableau_list[0] -%}
<span class="tableau-objective-line">{{ "%-4s = %s"|format(first_var, first_expr) }}</span>{%- for i in range(1, tableau_list|length) -%}{%- set var, expr = tableau_list[i] -%}{{- "%-4s = %s"|format(var, expr) -}}{%- if not loop.last %}{{ "\n" }}{% endif -%}{%- endfor -%}
{%- else -%}
    (Bảng trống hoặc không có dữ liệu)
{%- endif -%}
                            </pre>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}

        </div>
    </div>
    <footer class="footer">
        <p>© 2025 Công cụ Giải Bài toán Quy hoạch Tuyến tính.</p>
    </footer>
</body>
</html>