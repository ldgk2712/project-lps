<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kết quả Bài toán Quy hoạch Tuyến tính</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f4f8; /* Nền xám-xanh nhạt hơn */
            color: #334155; /* Tailwind slate-700, chữ mềm mại hơn */
            line-height: 1.6;
        }

        .container-wrapper {
            max-width: 1000px;
            margin: 3rem auto; /* Tăng lề trên/dưới */
            background-color: white;
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.06), 0 20px 40px -15px rgba(0, 0, 0, 0.08); /* Đổ bóng tinh tế hơn */
            overflow: hidden;
        }
        
        .back-button {
            display: inline-flex;
            align-items: center;
            background-color: #6366f1; /* Indigo 500 - nền nhạt hơn một chút */
            color: white;
            font-weight: 500; /* medium */
            padding: 0.625rem 1.25rem; /* Điều chỉnh padding */
            border-radius: 0.5rem; 
            transition: all 0.2s ease-in-out;
            margin-bottom: 2.5rem; /* Tăng lề dưới */
            text-decoration: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05), 0 1px 2px rgba(99,102,241,0.15); /* Đổ bóng mềm hơn */
        }
        
        .back-button:hover {
            background-color: #4f46e5; /* Indigo 600 */
            transform: translateY(-1px); /* Hiệu ứng nhấc lên nhẹ */
            box-shadow: 0 6px 12px -3px rgba(99,102,241,0.2), 0 3px 7px -3px rgba(0,0,0,0.08); /* Đổ bóng rõ hơn khi hover */
        }

        .back-button svg {
            margin-right: 0.5rem; /* Giảm lề phải của icon */
        }
        
        .results-header {
            padding: 2.5rem 2rem; /* Tăng padding */
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 60%, #818cf8 100%); /* Gradient mượt mà hơn */
            color: white;
            margin-bottom: 2.5rem; /* Tăng khoảng cách sau header */
        }

        h1.main-title { 
            font-size: 2.25rem; /* Điều chỉnh kích thước font */
            font-weight: 700; 
            margin-bottom: 0.5rem; 
            text-align: center;
            color: white; 
            letter-spacing: -0.01em; /* Giảm khoảng cách chữ một chút */
        }

        p.subtitle { 
            text-align: center;
            color: #e0e7ff; /* Indigo 100 - màu sáng hơn cho phụ đề */
            margin-top: 0; 
            font-size: 1.05rem; /* Điều chỉnh kích thước font */
            font-weight: 300; 
        }
        
        .content-wrapper { 
            padding: 0 2.5rem 2.5rem 2.5rem; 
        }

        h2.section-title { 
            font-size: 1.75rem; /* Điều chỉnh kích thước font */
            font-weight: 600; /* Semi-bold */
            color: #4338ca; /* Indigo 700 */
            margin-top: 2.5rem; /* Default for titles NOT in a result-section (e.g., "Chi tiết các bước") */
            margin-bottom: 1.5rem; 
            padding-bottom: 0.75rem; 
            border-bottom: 2px solid #e0e7ff; /* Viền Indigo 100, dày hơn một chút */
            display: flex;
            align-items: center;
        }

        /* Rule for h2.section-title if it's the very first title in content-wrapper AND NOT in a result-section */
        .content-wrapper > h2.section-title:first-child:not(.result-section h2.section-title) {
             margin-top: 0.5rem;
        }

        /* Rule for h2.section-title when it IS INSIDE a .result-section */
        .result-section > h2.section-title {
            margin-top: 0; /* Rely on .result-section's padding-top (1.75rem) for spacing */
        }


        h2.section-title svg, h2.section-title .icon { 
            margin-right: 0.75rem; /* 12px */
            color: #6366f1; /* Indigo 500 */
            width: 26px; 
            height: 26px; 
        }
        
        .step-details { 
            background-color: #ffffff; 
            border: 1px solid #eef2ff; /* Indigo 50 cho viền mềm mại hơn */
            border-radius: 0.5rem; 
            padding: 0.75rem 1.75rem 1.5rem 1.75rem; /* Top, Right, Bottom, Left. Giảm padding-top */
            margin-bottom: 2rem; 
            box-shadow: 0 2px 5px 0 rgba(0,0,0,0.04);
        }

        h3.step-title { 
            font-size: 1.375rem; /* Điều chỉnh kích thước font */
            font-weight: 600; 
            color: #4f46e5; /* Indigo 600 */
            margin-top: 0; /* Loại bỏ margin-top để dựa vào padding của parent */
            margin-bottom: 0.5rem; /* Giảm margin-bottom */
        }
        
        .result-section {
            padding: 1.75rem; /* Điều chỉnh padding */
            background-color: #f9fafb; /* Tailwind Gray-50 */
            border: 1px solid #eef2ff; /* Viền Indigo 50, rất nhạt */
            border-radius: 0.625rem; /* 10px */
            margin-bottom: 2rem; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.02), 0 6px 12px rgba(0,0,0,0.03); /* Đổ bóng rất tinh tế */
        }
        
        .label {
            font-weight: 500; 
            color: #64748b; /* Tailwind Slate-500 */
            margin-bottom: 0.375rem; 
            font-size: 0.875rem; 
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .value {
            font-weight: 600; /* Semi-bold */
            color: #4f46e5; /* Indigo 600 - cho nhất quán */
            font-size: 1.3rem; /* Tăng nhẹ kích thước */
        }

        .status-optimal-grid { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); /* Điều chỉnh minmax */
            gap: 1.5rem; 
        }

        .optimal-solution-title {
            font-size: 1.5rem; /* Kích thước font cho tiêu đề Nghiệm tối ưu */
            font-weight: 600;
            color: #4f46e5; /* Indigo 600 */
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
        }
        .optimal-solution-title svg {
            margin-right: 0.625rem; /* 10px */
            width: 24px;
            height: 24px;
            color: #4f46e5; /* Indigo 600 */
        }
        .optimal-solution-hr {
            border: 0;
            height: 1px;
            background-color: #cbd5e1; /* Slate 300 */
            margin-bottom: 1.25rem; /* 20px */
        }
        .solution-item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.625rem 0; /* 10px top/bottom padding */
            border-bottom: 1px solid #f3f4f6; /* Gray 100 for subtle separator */
        }
        .solution-item-row:last-child {
            border-bottom: none; /* Remove border for the last item */
        }
        .solution-item-var {
            font-size: 0.95rem; /* Kích thước font cho tên biến */
            color: #374151; /* Gray 700 */
            font-weight: 500;
        }
        .solution-item-val {
            font-size: 0.95rem; /* Kích thước font cho giá trị biến */
            color: #4338ca; /* Indigo 700 */
            font-weight: 600;
            background-color: #eef2ff; /* Indigo 50 */
            padding: 0.25rem 0.5rem; /* 4px 8px */
            border-radius: 0.25rem; /* 4px */
        }
        
        pre {
            background-color: #f8fafc; /* Tailwind slate-50, rất nhạt */
            padding: 1rem; /* Giảm padding cho khối pre */
            border-radius: 0.375rem; /* 6px */
            overflow-x: auto;
            font-family: 'Roboto Mono', monospace; 
            font-size: 0.9rem; 
            white-space: pre-wrap; 
            border: 1px solid #e2e8f0; /* Tailwind slate-200 */
            color: #1e293b; /* Tailwind slate-800 */
            line-height: 1.5; 
            margin-top: 0.5rem; /* Thêm margin-top để tạo khoảng cách với h3.step-title */
        }
        
        img.plot-image { 
            max-width: 100%;
            height: auto;
            border-radius: 0.625rem; /* 10px */
            margin: 1rem auto 2rem; /* Giảm lề trên của ảnh, giữ lề dưới */
            display: block;
            border: 1px solid #e5e7eb; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.07); 
        }

        .footer {
            text-align: center;
            padding: 2.5rem 1rem; 
            font-size: 0.875rem; 
            color: #64748b; /* Tailwind slate-500 */
            background-color: #f8fafc; /* Tailwind slate-50 */
            border-top: 1px solid #e2e8f0; /* Tailwind slate-200 */
            margin-top: 3rem; 
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container-wrapper { margin: 2rem 1.5rem; } 
            .results-header { padding: 2rem 1.5rem; margin-bottom: 2rem; }
            .content-wrapper { padding: 0 1.75rem 1.75rem 1.75rem; }
            h1.main-title { font-size: 2rem; } 
            p.subtitle { font-size: 1rem; }
            h2.section-title { font-size: 1.625rem; margin-top: 2rem; } /* Default responsive margin */
            .result-section > h2.section-title { margin-top: 0; } /* Ensure it's 0 in result-sections on mobile too */
            .content-wrapper > h2.section-title:first-child:not(.result-section h2.section-title) { margin-top: 0.5rem; }

            h3.step-title { font-size: 1.25rem; }
            .back-button { width: 100%; justify-content: center; padding: 0.875rem; margin-bottom: 2rem;}
            .result-section { padding: 1.5rem; }
            .step-details { padding: 0.75rem 1.5rem 1.25rem 1.5rem; } /* Responsive padding for step-details */
            pre { 
                font-size: 0.875rem; 
            }
            .value { font-size: 1.2rem; }
            .optimal-solution-title { font-size: 1.375rem; }
            .solution-item-var, .solution-item-val { font-size: 0.9rem; }
        }
        
        @media (max-width: 480px) {
            .container-wrapper { margin: 1.5rem 1rem; border-radius: 0.5rem; }
            .results-header { padding: 1.5rem 1rem; }
            .content-wrapper { padding: 0 1rem 1rem 1rem; }
            h1.main-title { font-size: 1.75rem; }
            p.subtitle { font-size: 0.9rem; }
            h2.section-title { font-size: 1.375rem; margin-top: 1.5rem;} /* Default responsive margin */
            .result-section > h2.section-title { margin-top: 0; } /* Ensure it's 0 in result-sections on mobile too */
            .content-wrapper > h2.section-title:first-child:not(.result-section h2.section-title) { margin-top: 0.5rem; }

            h3.step-title { font-size: 1.15rem; }
            .result-section { padding: 1.25rem; border-radius: 0.5rem; }
            .step-details { padding: 0.5rem 1rem 1rem 1rem; } /* Responsive padding for step-details */
            pre { 
                font-size: 0.825rem; 
                padding: 0.75rem; /* Giảm padding cho pre ở màn hình nhỏ hơn */
            }
            .value { font-size: 1.1rem; }
            .back-button { font-size: 0.9rem; padding: 0.75rem; }
            .back-button svg { margin-right: 0.4rem; }
            .optimal-solution-title { font-size: 1.25rem; }
            .solution-item-var, .solution-item-val { font-size: 0.875rem; }
            .solution-item-row { padding: 0.5rem 0; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col"> 
    <div class="container-wrapper"> 
        <header class="results-header">
            <h1 class="main-title">Kết quả bài toán</h1>
            <p class="subtitle">Phương pháp đơn hình</p>
        </header>

        <div class="content-wrapper">
            <a href="javascript:history.back()" class="back-button">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
                Quay lại trang trước
            </a>

            <div class="result-section">
                 <div class="status-optimal-grid"> 
                    <div>
                        <p class="label">Trạng thái:</p>
                        <p class="value" id="result-status">{{ result.status }}</p>
                    </div>
                    {% if result.z is not none %}
                        <div> 
                            <p class="label">Giá trị tối ưu z*:</p>
                            {% if result.z is number %}
                                <p class="value" id="result-z">{{ "%.2f"|format(result.z) }}</p>
                            {% else %}
                                <p class="value" id="result-z">{{ result.z }}</p>
                            {% endif %}
                        </div>
                    {% else %}
                        <div> 
                            <p class="label">Giá trị tối ưu z*:</p>
                            <p class="value" id="result-z">Không xác định</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        
            {% if result.solution %}
            <div class="result-section">
                <h3 class="optimal-solution-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Nghiệm tối ưu
                </h3>
                <hr class="optimal-solution-hr">
                <div> 
                    {% for var, val in result.solution.items() %}
                        <div class="solution-item-row"> 
                            <span class="solution-item-var">{{ var }}</span>
                            {% if val is number %}
                                <span class="solution-item-val">{{ "%.2f"|format(val) }}</span>
                            {% else %}
                                <span class="solution-item-val">{{ val }}</span>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        
            {% if plot_data %}
            <div class="result-section" id="plot-section">
                 <h2 class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" />
                    </svg>
                    Hình ảnh hóa (Bài toán 2 biến)
                </h2>
                <img src="data:image/png;base64,{{ plot_data }}" alt="Biểu đồ miền khả thi và nghiệm tối ưu" class="plot-image" id="plot-image-src">
            </div>
            {% elif result.plot_error_message %}  
            <div class="result-section" id="plot-error-section">
                 <h2 class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Lỗi Hình ảnh hóa
                </h2>
                <p class="text-red-600 font-medium p-4 bg-red-50 border border-red-200 rounded-md">{{ result.plot_error_message }}</p> 
            </div>
            {% endif %}

            {% if result.steps and result.steps.items()|length > 0 and not result.status.lower().startswith('vô nghiệm') %}
            <div id="steps-section"> 
                 <h2 class="section-title">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                    </svg>
                    Chi tiết các bước
                </h2>
                <div id="result-steps" class="space-y-6"> 
                    {% for title, tableau in result.steps.items() %}
                    <div class="step-details">
                        <h3 class="step-title">{{ title }}</h3>
                        <pre>
{% if tableau['z'] is not none %}
{{ "%-4s = %s"|format('z', tableau['z']) }}
{{ "───────────────────────────────────────────────────────" }}
{% endif -%}
{% for var, expr in tableau.items() if var != 'z' -%}
{{ "%-4s = %s"|format(var, expr) }}
{% endfor %}
                        </pre>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div> 
    </div> 
    <footer class="footer">
        <p>© 2025 Công cụ Giải Bài toán Quy hoạch Tuyến tính.</p>
    </footer>
</body>
</html>
